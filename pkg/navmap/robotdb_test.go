package navmap

import (
	"bytes"
	"compress/gzip"
	"crypto/sha256"
	"encoding/hex"
	"fmt"
	"io/ioutil"
	"os"
	"testing"

	"github.com/rs/zerolog"
	"github.com/simonswine/rocklet/pkg/api"
	"github.com/simonswine/rocklet/pkg/apis/vacuum/v1alpha1"
)

var exmapleDatabase = "1f8b0800000000000003ed9d077c53c51fc013868208c89455966ce18fc8109051649436797979b9dcbd3d93a6cd0e201b448620a3b2558688a8adc806111922141007a2882802fa77306429537040ffcf02d24dfba750d2dcb79f6b93974bfa7edf7777efeede48fffe550d4d58a3c1683018bed453504f250c350ccff4301a1aeb0b1d7aeaaea712ff64c06030180c0683c16030180c0683c16030180c0683c16030180c0683c16030180c0683c16030180c0683c16030180c0683c16030180c0683c16030180ca68830e64451afd45dc598969d885260ccd940e428d0434d5790d543c428d04b40a41bc8a10a4494821c1b818852908780c83090b508647e1e010ab2d5812c0b8abf02a3215bdc91a520876630c20a415ecd604428c86b4f78534151afe51dc498a52b98b38ff02d04b71eede6d740b82ac8baa3cf9e215f95e09a83b09c34b885817fc2c99f808c144924ff2fd90c64ae146979f50272093fcc4a417603d737e2bf4b0a66203db7c110460ab21948bb6ee0c62bc6fc6df90c0ad2cb518156a248ab4db621cff5b62cc3a6cf6f5398317b410c1471b391f3a02fdf3b80dc35e4b7221479b399e7b0f7360ce4af2928f2f00d590de4b5ed0bd61ae4c7c0bd107f5603798c01b2ed196f61e0964dc1bd117f010cdcd4902f03b7680cef95f00d791930dedc1d169cbc6bc13d147f5eedc01d33704fc55f9096b06006728bffde1b34dc5d03f75cf886bb6be05e8cff4e19c8616070ef15ffeb14be819c6649d2728eff9e9072270c64fd1fd7c2cf1cee3d117c3a77dec0b5d986ac0b72c85344148e81eb7369e9c53db381f485371efff3ecdf58d3d29f177df3505806720fe45a15b8468687f740ecd728b4329007ff049b969679c6f56ec5776b723450600db97701b3ce34dfd5e0f2453603c6c2339079d3df43cd7f2672345070f2aa05f768e437c87614bcf00ddce31496819b8796c24d462119c8f819451d5201295403c6eb9f11566003855b0b8c116120c361e55c5e2fea980a44f6b3e26e1e2ecc7d3b677410ee575de461201f18331a08a723e619c962205fa7ce657d4b7893bb817cf68fc3acd067e7f6cb0036504c0de47f90580c0d18af8de90b70a03cbcb9ed5a800d44a0817f7bc5378eae177508b7c9ff5506320d0c8a9981dc7ac5597afe69e9139fe1380cc84ecee794e6a020d3a18e2caf843385719cb0a863b83db081fc18b8d51976451dc3ed913f03d71bfe0cef0adb09916ce4cb402ef9ae7f4291ae7f2190a70163fa8cd835059962bff673ed038a74f50b81bc0cfc7b954dd68e92c1101106feedf5a54799e5ecdb7bf7507081c96bd23bc3263764ea11a5dd8be701fcbfe46220f3048931bb81e2e320d76140c680afd5f56cb9fe59563cdb81f47d7ca605ffe4cc2163313570a38f930f0337cb471893cdc08d3e5e8625d7da81083160cc418031fbdeb0181bb8b134e3a1a31cfa03c5d7c08d706e5c807df36840e41948ff9d61dc1769066e952f220de4ce5d5cdb3b41c10d18c2f65c899cc9af81e20b36800d6003d80036909381c8f290dd4064c59fc31d18224d404e734445bd4a77196c001bc86620c25bc2b462708e6841c96ea0a8d7e86e830d6003d840c41bc8e1aef445bd4a771b6c20b7e3869143f63b3014f51add6522ec9b187222e267c9b27e174551af4f11800de07620db3526110736800d6003d80036800d6003d80036800d6003d800368047c7b80ce032800d643b5e90e7a504395c5210f6971a643f6a96f10b7dd2722663a859aece0d3ff2bcff40aed71866b933cf4d0361e8e0f6efc492d94c51c753700ad7002e03b80c84a3026ca0700d846397aa90cb40183685856ae07a4fa1a8632a18856ce09a86a20eaa4014ba01e3f56fb62aeac0f24de11b08b7a6e08ed482b0b270270ca4855325c87b749c4b7469b7bea3751895826c06322eca34fa355eff959f2fbf0ea77d624e0632cdf9a4df8ec598c1407aba45ed3186d1e54a3918c8f0e2b55fc6f4d30e331948bbb12017036174e96a9e0632869196bd3ae45506c2a72dccdb407a8eac398d37b6729e65206cb8b5814c39d36bc1f52fefcdab29082305f9377083b47fef521b4906723b6e9043e86177e4a0e065208f3787d7c6bf0e36707b06f23ea0161e64bbd2eab63eacb0d6ea6e52a806c2922ced79786ec6db039f4482afb5cae1db6c3237ea59468b61dae2e745b6b6f05a8370f3f52cf98b5f49c979ba27b7bc4663f1339053cf2ed7acc662b9d32cc02d898cb7ca109e64af069166a00077e2c00622d38031879cc5cd40ee3723b9f120eb9c500418c836dacf6735095372d819640bb5788f1ef233f18f0d6003c5d6c0b563a3116e20f7f023c280e1c6be3e920dfc0336906b5310a9066e768223d6c0bf4b23de406e07ca8bbb810c43c35b350fc5875c0c14dbaff4cb8e31c7f872ed2c6203d840a418c8fde4e1626ee0d6bb82c83190ebb8b19819c8d6e1b931459afbbc41713790766364103106720d34e7e823de002e03d84071349077ab9735f86268201d6c001b28586350ac0de4ab4528e6066e41b13770ab8dffcfef6279067a81da81627642e535b0817cb57fd7270c8adbb9e5d7c065001bc0060a66a0a8d7f64e800d6003f9db1bdef85bd46b7b27284819289602702dc8cf6d9a3350d46b8bc16030180c0683c16030180c0683c16030180c0683c16030118fd15046ff31182ac61b0c7f3b0ce9cffe794e3306c33193c150d250d510fdb0c1f0456983a1d48d37390dce8ace36cedf1c4f38673b44e76087ec2ce530397b6a26e76835d6b94b79cab948f9ce3153d9e8e014bbe39cdcdc7144bea44d90dfd42e49af6973a43d9a4b5aab9d113768c9e2314d138f6a55c4b28e1f848b5aa270542b29d4712ce4ab3858be86a3027f4e9bc71dd054ee84f6397b589bc45672706c39c70aa6ba630653cd6161f66a87e9155a349daa7d859a3a96a1c58e4dc8e5dc8c6ac76f464be397a0bdf1efa3beae0f91db351bf95d2fa3e9aeed688deb006a9ef0302d2458e845096fd33b123ea6b7267c467b12cfd275dd5666a8fb0b66ba7b0c3bd8bd8d75bbdf613f76af611ff428ec49f7026697bb3673dabd9e069e2fe8573c6be8f25e03ddd83b075df68c413b3cc3517bcf00f48ebb310ab84b20d5dd08b575b7458b12ff827f259c8407137e870f249a903771398a4bdc833e4b5888ca278c47a35cefa15eae0f507fd75e542ba1111d9ff0183d3c611abd316137fd69c21e3a36f14b7a78620add3bb13ebd36613eaa972020972b843e8d7f01cd8c1f87cac57b11e9e4d00407873ed43874bfc62342e5d1348547dfc822aa220b0848029a2bf268afc0a19a82849ee637a387f9df50257e2f6ac8fb507f7e247a978f471e61042a27ce42bdc449e805712232493350055977278f42cbe47e485156a06f95c7e98755826eaeeea0cdaac234555f662e292dd9bf14177b5571b2b5d479ec30b50c37559538a06ee02aaa67b83f9464dea0fa04a3da424c538e8b5794ff4857945ed213ea3ca99fba498a579f961d6a35c5a17eab706a3fb59bba4abdacdcaffdaaccd3ce29ef6b679535daebea6a0d69e51c9f6abce3a836d451cdf1a563bca383f30d4727e711477b673de7364713e79bfab3998e0aceb7b512ced36a696740fdc491a64c756c51273a3ed0c63bca3b9e73947000c779ad9e23468b7200b59ee39cf2906388f29986948dda653d5d50dfd7446dad36480b6a5db51e9aac466bbd94ae5a13b9a75641eaa39d12fa68bbf9186d3917a34d6563b4a14c1fed59bab7f6137a4a7b1bd5d4b6a11fd41ef4215560feabf6670fa8d3b9fdea0a7ebfba57f8463d257eadde2fef531b287bd42eea2ef54f75b75a435baff6d0147586ea549be9e923c5a9262a2eb58c92a82e96bd2a2107d493baa781d240758538449d260c5607f183d5527aeacc2d50157689ba8449513b339fa9d3698776167dae4d42710e1f7ac4e9414fc50f44355c63d101d7363422a13a9d9ad0973e9aa0d0251347d2bec4d1746a62097a7de24a743071236aeaae47b7718fa25bbb27d0c3dd53e80fdc67d15af701f4b37b17aae5f90355f20ca52b7a10fdacc7462ff350f45ecf18fa47cf4efa9c5e17feebd9457feb49a165ef24ba8e6f00bdd7b792eee68f62c6f99399897e965defff9ddde11fc98df0cfe52ef856712d7cdbb81ddee9fce75e42f8c49b2a8cf09e174a794f0856cf4f42234f5531cab35bacea692d95f73497bef13492c67beb4b1d7c75a403be1ad2087f6da956204a8a0e54905a06d68a0f05ba8b3d0295455fe0982007b608a302070425f08ae00ac8c2b840b4f07dc0233c149c24540f0e14ca0405e16ae049e187406b614da0bd3035d053181c08094c609a400486094f061a0b64a0acd03fb0857f3990ca1f0aa4f02702737922b89a7f2df81b7f216816da87fa0bd1a169823bf486303c1410fa85da0adb42ed854ba1abfcf99087bf144ae14e844eb097438fb167435ee6b7d0dbf4f9d03174343407fd124a4175436f213eb814cd09ac4047fdcfa089fe01a8a13f11bded53d1289f8676fb46a258df30b4d8eb432e6f02eae8f5a321dea751aa773c7ad63b196df14c4082e71c7ac1b3884ef5eca3b77bd6d325bc0be8315e0b5ddfdb801eeead48aff3d6a0dbf96ad3ab7c35e9c7fd55e945fe23e8b49fa6ffeb8f657ef47fa7a773ec057f1a5732308c2f1798c6ffe8dfcbfde07f9a3bec5fc5a5f821bfc81f1416facde26bfe65e242bf510af8cf8be5fd03c4c33e5a38e00bf2fb7c7f725b7c3f702e5f7bfe115f05a1baaf9ef8906fba58c9b746dceadd258ef72e1307791f1307787b88473d23c56f3d1bc4af3d7bc58067b538cb13250ade11426bdf21fe4f5f34bfdbff005f35f013d737b09ceb1d20b89e81d36c74a022db25309e7922f018d321709cae1c8074d3c0afa85fe01c5a1af805950d3e428f09cea6df0fd662b6066dcc8bc1614c42702573393089f1049a32e5025fd269fe4974693d7fafc0e7e8ddc0d7c8113c8816074fa2daa15f9137b49c16429b1939b4875543a73931f4124f8712f85f824ff26f062f738b8273b8d7831db93783abd9946055f6ade0556672f00f665570103b39f816db2f78820d0463b860702b170836e73dc16e7c83e032ae4cf0b89e6af325835d794390d3532dfe62a0323f2f70886b1598cc7def6fcdadf057e192fd93b969fe0fb9b6baef2dbe69dc02df2c6e9c6f0377c2bb95dbe53dc06df13ec7eff6f612bef07e248cf25612f77aae0a233c0705d6f3bd70dafdbd60761f125ab9078b5ddc27c5ef132b4a8989a5a54b09a5a543093da5d484765230b195f498bba5f493bb8534d4b34f643cd545d9f38da078f60bcd3c87845dee28719f1b883fbaa1c87b6ce269cf15c1e59d275cf21ee6833e81dfeffb82b3f91ddc12ff0ef6a4ff3ef688bf0f73d23f8ddeef2f4bbfefdf8952fcf3d012bdecbee4ef8380df87cefb02a8b35e6e877a9f43ef7a26a2769e3f91c5d3835ee4b1d28217d0957c80deeeb3d3c3fc50df9635f56db911750dcc40aec05ad43a908466f83944f9e3d1a3fe37f5f27f16a9be727467df8374695f353ac6fb93be7f4d46c33c01c47982a887c78df6b86ba2b1eebfe140776544ba9f42d5dc3dd16b897fc3df12d6c36e0963e0785717f8597c753826fe69f87efc08c8c66bb05b7c15e889af05a9f87a709cb3015ce778049ed71ac1965a63e8579bc0154a5378416e0a3bcb2de020a9057c476c062f0b4d605ba1310cf08de105ee13f80737011de32ea013dc2fe8017e0532f216d48e6f85e6f132bac207510b2184be155e40edc517d0527d3f9aa8ef439beafb504e1e8e36cb039147d988be5436a353ca7ab4587d17f9b475a8b5e33df4ab63235aaaf75decf11fa0e7e293509ade7fd15c4bd079d7db6856c26ba873e25c7424f10df48afb79bd1d1e848eb869f498bb37ea9ed80d5d4c08a299090ed4294146275d4fa3b9ae1834d3751e4e736d80cd5d83f5f867c3e3f13c3c1fdf0c1e8eefaeff1d02fbba26c00aaeddf042fc5158d2d5069d8c8fd6fb4cfdd1a67813ea195f1a1d762e820b9cdde033ce87e170670d58de59176a8e9570a3a31daaec34a106ce95b0b6938546270f373b36c2b71c044a76cc41f18e7ea88ae3342cebe8078d8ede708d3616f6d7aaa141da5894a8cd440f69ddd16135051e53cd70b3ca4345dd05fbaa3664569f401f295168933205a62abd6092e2871d9533b08d5213b5525aa115722a4c9105385d86b0b7bc0c3691dba066b20f1d913aa2f9d22a3847027084648775a46df08ad8075d1207a0d5627b344c4c8683c5a9d0213e03ab88cfc3d9c2545842488213f8a9b02bff20acc4d780d3b93a701f1b05abb1f520c5d48349747df831aa0fcbe9c902ebc199f628b80744c14aa00ea46c0fc3d9d4c3f02b6b4d58d9da089e225bc210590746912de0484b1bb889680d2f9a1f83adcdade04ed340b8c3f4285a6e9a82de328d47674de3d0bbe667d170e219d4da32129db68c40ef9143d100ebd3a80b15426954006db54d4314284327032bbd11307405bb9bfeca1ea29bc1de743758977e1cbe859c5042272144b39188206d470d191efdcccc4789ecdf6821fb207d88ad4a5f657f4793b9a3e8303707b5e4ef436df858d88eaf08dbf3d5e109ae069cc9f5844bb8853095e3d007dcb37a7a1eb1dc4118cff920c3d1f041fdb583ac82be6557a17d6c17f40c5b1a99d9399062c7c34f98d19064f4ed444f853de924ddd564d8574fefc3c9b00fac800838049583dfa06fecc7e101bb07eeb57786a3ed2360577b7bd4cd7e0875b5af4355ec71680378182583713005c4402718a1fb2d81ee07f55009d0024db1ad80493605f6b3c5c3476d1fc26ab6eaa88aad0eda4235412f50c7611235004ea420ec49bd00ab5155512daa057ad13a19be680530de3a0036b69e8251d6eaa8beb5055a4a6e87f3490d4e2039f824b916d6246ba1da640374dcd214bd66b90a975a86c1372c76e8b08c872d2d15510b4b6bb498580d57103c9c4970d04cac87ed8828d48e68827e37b7466f9a2ba0b7cce3e062330943e601b0b3f934ec60ae8dda991ba0bf4c2e74d23411fd683a0a2f99bac3aba61a30cdd4080e353583ebe29ac17e71cbe0e4381e4d8f9b8a66c48d458d4ccfa2a3a62864d0dfeb3745a3caa613b08a6906ac669a0879d32468354f8001e27938dd3211ae2327c383d6297011350bf6b5fd0d0fd986220fd88f3682f2f40610452f043cfd16b848af002ad3074c663eb08d66acb6d7998bd444660895c0582885694eb998f15627934a4a0c452e637c6473b60e6965e75baab2352c49ccd74457e610d188f98a68c8988916ccabe656cc39530ba693b92df3a7a921d3d3dc81a96a7e82d96f72e96933b3db94a23f5fc5bc6baec6362156b05d8846dc61732f6ebd79006724fee61a12c3f95fccdbf978f3277cb47935ff8cf907fea4d92c9427960bdf9a170aaf990f08e3cdd1e2a7e64de206731789325ba41da609d226d353f272934179c5b455996baaacbe626aa96e37f550bf331d55ca9a53959ae6614ac8fcbcf2b3f91da512f197028991ea10e255b53f21abfb08561d6d09a9d1e44bea6e72b76ab06e54ab5967abe5ac75d5fbaceb944ed6379587acb1ca4ef267f92b72937c902c25af24174a9bc99ed24af263f16bf225f157f249b193b5a5b8ceda4fec405d16fd5448e2a95d524bea8414453d28b7a5526433b555f6511d95d7a9f9ca2c6a8a7286f22aa7a818658fbefc53ca27ff41b5951fb61d93ce531ba553d47ce967ea3fd24cea7531897a5cfc85aa2e0eb251e2afb6afc547c1fdd26360ae34007492c7826f6504da2808cc551e012f29cf034949014f2a25ec82d2c6de45d90a1628d380a21c0436e5713ba554b673ca16d04349056e651e18a3bc02362be3c13ce5653050590d062b53c008c501024a1c98a6c480b7942e609262010b95762059a90d929427c0286510784ea1c068e525f0bcd2074c549ae8ffbb1258a69cb12d52eed71fd7d79775063e6502909515fafa0c04f594b1e0843c116c9167811df20070467e42ff8bc0df72397044ae09fe904b83efe51a6097dc02bc2777078be4b660aa1c0352e4d6e0a05c467f5f53b0406e099ac966d0416e036ac971c028cba0a2dc0774d1f327ca1dc10cfd3defe8ef37282d419a4c812f6427f88f1c02072537d82a2582fdd26090268d0395e564dddbc7a0afbc1644cb33c162f935b05ef738527681ee320134d9aebf1603149901b172579020436096a3410f990335f4ff6fd0979d911e04e7a5eefae7350317252ff8419a068e499f8095d220f0aaf432182e5d05e3a586f6e7a42b4095cad81dd211304e1a0f5a497d4007e915d04c7a165c12cbd9abe8792e88df8379d2545056fe087c250d03cba536fae7f4030ba496608d6400dba44db6c512d29f8f0249d2db6084f41918261d03a3f5cf9da1bf7fa4740928526bbb242d0315a54d60a7781aa48865ecc9e223f6f9a2d9feacd8cbeed0534931d67e54e861df265c00978515c02036045f0ba76c0b85e76c2d85806d0fff8e6d099f6a7b8ebf622bc7b70066be1c98c3ff65f3f025412dfe01b0926b0c26722218c50d059db868f02e1b033ab073c1bbcc03f61acc60fb48fab4bd95bebfe94827d83beaedcb13f47c309d5e0696d1ab403d661430333c58c87407bf306d01c3d60731dccfb6c9dce7b6dedc7bb61eec07b69f992db6fd4c92ed23a68bed3d6690ed1273c0a6b1a76d1bd9e5b64fd929b607389bad13f7115596eb464d60ffb25e656a52ab99717aaa64bbc28cb045b3536d17d9d76c8bb8edb65fb975b6527c9ced3e3ecae6d45353a19e6d9d9ef60ac7a82bc2748a10a651edf8d9d41e6e363556ff3c81ab4495e72b510d856ad4ab42256aa770d49a2cacb2961552aca7b937ac3fb36f5a3bb0c9d6834c929ea2adddd896d63e5c1bab836f6ea58446d6d54235ab475c4eae14279323c549a45f9848027e22d9899b4c6e629348554fb3d84164158e271339488ee0113957b091ef8914b943b293fb6444ae5168b2aeda8d6cacfe68f954d96c39a2ecb49454575908b5b745541b5a5875a945537de41bea77e4676a1af9a55acb4a6994d5a5b9ac497a5aa53f9ea901eb40ada3b5aed6d3fa9b6ab196d0da59b7a967495a3d4836572f92bb944ad69794b36453456fc3f47454de4c2e96d793cde4247282349d94a464b2aeb49a5c206e27bb8b6dacbdc48dd625624baa9dd894fa4ed86f2d2fdaad63c52de4efa24aae9500d943ee4d3e23d722e7c865c9414a59729f721ff9b6528a5c2e9726a74b25c890781f490865c9767c59f271ae2cb9937d806ccfa55a0e71db2d97f8ed968a62aae55169bb658cb4c3f289f481a5aaecb594922f126f4a6b880ed2974419a99da593f4aa6588b4c932521a6ca92335b47c279e225a8a6788b2c225e224f707f13bfb07f1929eaeb2b4a52b77cc427029a48353ad23b97a543fee0055951b6d1bc27e6f2bcf1eb01d6296d87630cfdb563209b69799eab66446a56632b3ade3983fc9d94c12f911e3d6f76df5c869ec8b1685bdcf528ddd469c61d613f7b3c709899d6451d9aae452b60d5999db6a91b9a696386e0ff118b79ad8c02e2782ec32622dbb86f8885b459ce1df212a882b8917c4a5c43cf11942145b109f098f12738516c483e2234463a909f194dc94382c37211a2816e233d944ac944cc44cd1420c162cc43c9e221278481ce3bb13a5c54a444de947f348e973b32aef3497553e328bca347337a58339556e623e2e3536efd053aa74d5c4492f9bbe14ab990e8b57e3ea4b73e31a4a43e3164aa6b863d291d873d2a658281f8a3d20bf1cdb50a91e7b457ebeef09d9ddf7805cb2ef103925a6a33c33a6a9bc24669d9c1cf388f26acc70a542df5f94a57d29d5123b569d15db477d23b6b47a35b696da3f6e98ba328e57b7c4d552e7c52d57de890b29554d3ea5b3c9a9bc6f1aa29c353daa9c3125c8674c29d219536be99ca997f4a2e98cd8d8f4b958ddf4937839aea6b4292e51ea6a9a228d31fda1a78df228d3efb2cb5457a967aa2b3730cd901e31ed91d6c7fd2e2d8ffb585e1dd74479236ea2628f5ba0f48c4b95a3e368b95bdc62b9545c036543ec106549ec1bcad25887523eee7ee5fdb889f25a535939d9bc52b212dda42a9624f1b4658bb082fc951f6c8de6eb53abb865d47fb876b615ec161ba597890aec2adb4166bc6d15f30bf51ec351cb98246a3173805acefc45a5304ba817994fad539826d6494c496b32b3935cc9cc268d2c4f3ad95f2d6e96b554600f1373199618c22c334bcc13e65e4c19731453dedc98d9636ac63c6b42cceba621cc68d35a669be934f3b9e90be694692533c8bc9b4935f7617698ab321f9a1b3093f5fc474c759992e6860c696ece34379b99632643a93286aa0683e107ea7893f3e5e35fffbaf1975b6a2debff6894d2b4ffff004e35ef663a590100"

func newNavMap() *NavMap {
	logger := zerolog.New(ioutil.Discard)
	if testing.Verbose() {
		logger = zerolog.New(os.Stderr).Level(zerolog.DebugLevel)
	}
	n := &NavMap{
		logger: logger,
		flags: &api.Flags{
			RobotDatabase: "./robot.db",
		},
	}
	n.flags.Kubernetes.NodeName = "rockrobo-test"

	return n
}

func TestListCleaning(t *testing.T) {
	n := newNavMap()

	if _, err := os.Stat(n.flags.RobotDatabase); os.IsNotExist(err) {
		t.Skipf("robot.db not found skipping: %s", err)
	}

	cleanings, err := n.ListCleanings()
	if err != nil {
		t.Error("unexpected error", err)
	}

	if len(cleanings) < 1 {
		t.Fatal("no cleanings founds")
	}

	tmpDir, err := ioutil.TempDir("", "rocklet")
	if err != nil {
		t.Fatal("unexpected error: ", err)
	}
	defer os.RemoveAll(tmpDir) // clean up

	for _, c := range cleanings {
		err = ioutil.WriteFile(fmt.Sprintf("%s/%s-map.png", tmpDir, c.Name), c.Status.Map.Data, 0644)
		if err != nil {
			t.Error("unexpected error", err)
		}
	}

}

func TestConvertMap(t *testing.T) {
	n := newNavMap()

	data, err := hex.DecodeString(exmapleDatabase)
	if err != nil {
		t.Error("unexpected error", err)
	}

	r, err := gzip.NewReader(bytes.NewReader(data))
	if err != nil {
		t.Error("unexpected error", err)
	}

	cleaning := &v1alpha1.Cleaning{}
	err = n.convertMap(r, cleaning)
	if err != nil {
		t.Error("unexpected error", err)
	}

	if exp, act := "c529919af8f8c1e26955367dbfceabb95a1d1f204f0cc04165f357f9d8bbe4da", fmt.Sprintf("%x", sha256.Sum256(cleaning.Status.Map.Data)); exp != act {
		t.Errorf("unexpected result exp=%v act=%v", exp, act)
	}

}
